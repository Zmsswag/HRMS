{% extends 'myapp/base.html' %}
{% load static %}

{% block title %}任务详情 - 综合人力资源信息处理系统{% endblock %}

{% block extra_css %}
<style>
    .container { padding: 15px; padding-bottom: 80px; }
    .header { /* ... styles from previous templates ... */ }
    .detail-card { background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
    .detail-header { padding: 15px; border-bottom: 1px solid #eee; }
    .detail-header h1 { font-size: 1.5rem; margin: 0; }
    .detail-body { padding: 15px; }
    .detail-section { margin-bottom: 20px; }
    .detail-section h3 { font-size: 1.1rem; color: #007bff; border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 10px; }
    .meta-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem; color: #555; }
    .progress-section .progress-bar { /* ... styles from list ... */ }
    .progress-section span { font-weight: bold; font-size: 1.2rem; }
    .assigned-users li { list-style: none; padding: 5px 0; }
    .action-btn { display: block; width: 100%; text-align: center; padding: 15px; background-color: #ffc107; color: #212529; text-decoration: none; border-radius: 8px; font-weight: bold; font-size: 1.1rem; }
</style>
{% endblock %}

{% block content %}
<div class="header">
    <a href="{% url 'task_list' %}" class="back-btn"><i class="fas fa-arrow-left"></i></a>
    <span>任务详情</span>
</div>

<div class="container">
    <div class="detail-card">
        <div class="detail-header">
            <h1>{{ task.content.title|default:"无标题任务" }}</h1>
        </div>
        <div class="detail-body">
            <div class="detail-section progress-section">
                <h3>当前进度: <span>{{ task.completion }}%</span></h3>
                <div class="progress-bar">
                    <div class="progress" style="width: {{ task.completion }}%;"></div>
                </div>
            </div>
            <div class="detail-section">
                <h3>任务信息</h3>
                <div class="meta-grid">
                    <div><strong>分配人:</strong> {{ task.assigner }}</div>
                    <div><strong>状态:</strong> {% if task.completion == 100 %}已完成{% else %}进行中{% endif %}</div>
                    <div><strong>开始时间:</strong> {{ task.start_time|date:"Y-m-d H:i" }}</div>
                    <div><strong>截止时间:</strong> {{ task.expected_end|date:"Y-m-d H:i" }}</div>
                    {% if task.actual_end %}
                    <div><strong>完成时间:</strong> {{ task.actual_end|date:"Y-m-d H:i" }}</div>
                    {% endif %}
                </div>
            </div>
            <div class="detail-section">
                <h3>任务描述</h3>
                <p>{{ task.content.body|default:"无详细描述。"|linebreaksbr }}</p>
            </div>
            <div class="detail-section">
                <h3>负责员工</h3>
                <ul class="assigned-users">
                    {% for assignment in assignments %}
                        <li><i class="fas fa-user"></i> {{ assignment.employee.name }}</li>
                    {% empty %}
                        <li>暂无分配的员工</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    {% if task.completion < 100 %}
        <a href="{% url 'task_update' task.task_id %}" class="action-btn">更新进度</a>
    {% endif %}
</div>
{% endblock %}